name: Build Hackage packages

on:
  push:
  pull_request:

jobs:
  nix-build:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        package: [ABList, AC-Angle, AC-Boolean, AC-Colour, AC-PPM, AC-Random, AES, AFSM, ALUT, ANum, AVar, AesonBson, Agda, Ansi2Html, AsyncRattus, BNFC, BNFC-meta, BerkeleyDB, BigPixel, Binpack, BiobaseNewick, Blammo, BluePrintCSS, Boolean, BoundedChan, CHXHtml, CSPM-CoreLanguage, CTRex, Cardinality, ChannelT, Chart, Chart-cairo, Chart-diagrams, Chart-gtk, Chart-gtk3, Chart-tests, ChasingBottoms, CheatSheet, CirruParser, Clipboard, Codec-Compression-LZF, Color, ConfigFile, ConsStream, Control-Engine, DAV, DBFunctor, DCFL, DPutils, Data-Angle, Data-Hash-Consistent, DataVersion, DebugTraceHelpers, Decimal, DescriptiveKeys, Diff, Digit, DigitGroup, DistanceTransform, DistanceUnits, Docs, EEConfig, ENIG, Earley, Ebnf2ps, EdisonAPI, EdisonCore, Enum, EuroIT, FAI, FailT, FenwickTree, FindBin, FixedPoint-simple, FloatingHex, Focus, Folly, FontyFruity, ForestStructures, FpMLv53, FractalArt, Frames, FunGEn, GA, GHood, GLFW-b, GLM, GLURaw, GLUT, GLUtil, GOST34112012-Hash, GaussQuadIntegration, GenericPretty, Geodetic, GeomPredicates, GiveYouAHead, Glob, GlomeVec, GoogleChart, GoogleSuggest, GraphSCC, HAppSHelpers, HCL, HCodecs, HDBC, HDBC-odbc, HDBC-postgresql, HDBC-session, HDBC-sqlite3, HGL, HListPP, HMap, HMock, HNumeric, HPDF, HSH, HSlippyMap, HSmarty, HStringTemplate, HSvm, HTF, HTTP, HTTP-Simple, HUnit, HUnit-approx, HaTeX, HaXml, HandsomeSoup, HasBigDecimal, HasChor, HaskellNet, HaskellNet-SSL, Hastodon, Hclip, Histogram, HoleyMonoid, Homology, HostAndPort, HsASA, HsHTSLib, HsOpenSSL, HsOpenSSL-x509-system, HsSyck, HsYAML, HsYAML-aeson, HyloDP, IOSpec, IPv6Addr, IfElse, Imlib, IndentParser, IntGraph, InternedData, Interpolation, Interpolation-maxs, IntervalMap, IrrHaskell, JSONParser, JuicyCairo, JuicyPixels, JuicyPixels-extra, JuicyPixels-repa, JuicyPixels-scale-dct, JuicyPixels-stbir, KMP, KdTree, Kleislify, LDAP, LPFP-core, LParse, LTree, LambdaCalculator, LambdaDB, Lazy-Pbkdf2, LetsBeRational, LinguisticsTypes, List, ListLike, ListTree, ListWriter, ListZipper, MemoTrie, MicroCabal, MicroHs, MissingH, MissingK, MissingM, Modulo, MonadPrompt, MonadRandom, Monadoro, MorseCode, MultipletCombiner, MusicBrainz, MusicBrainz-libdiscid, NameGenerator, NestedSampling, NineP, NoHoed, Noise, NumInstances, NumLazyByteString, Numbers, ObjectName, OneTuple, Only, OpenAL, OpenGL, OpenGLRaw, OptDir, OrderedBits, Ordinals, PDBtools, PSQueue, ParsecTools, ParserFunction, PartialTypeSignatures, PastePipe, Peano, PenroseKiteDart, PlayHangmanGame, Plural, PropLogic, ProxN, Pup-Events-Client, Pup-Events-PQueue, PyF, QuasiText, QuickCheck, QuickCheck-GenT, QuickCheck-safe, RANSAC, RBTree, RFC1751, RSA, RSolve, Random123, Ranged-sets, Rasterific, Rattus, ReadArgs, RefSerialize, RoyalMonad, SDL, SDL-gfx, SDL-image, SDL-ttf, SHA, SHA2, SQLDeps, STM32F103xx-SVD, STMonadTrans, SVGFonts, SVGPath, SWMMoutGetMB, Safe]
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v3
      - uses: DeterminateSystems/nix-installer-action@main
      - uses: DeterminateSystems/magic-nix-cache-action@main
      - run: nix-build nix/non-broken-haskell-packages.nix -A non-broken.${{ matrix.package }}
