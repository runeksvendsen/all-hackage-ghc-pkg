name: Build Hackage packages

on:
  push:
  pull_request:

jobs:
  nix-build:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        package: [ABList, AC-Angle, AC-Boolean, AC-Colour, AC-PPM, AC-Random, AES, AFSM, ALUT, ANum, AVar, AesonBson, Agda, Ansi2Html, AsyncRattus, BNFC, BNFC-meta, BerkeleyDB, BigPixel, Binpack, BiobaseNewick, Blammo, BluePrintCSS, Boolean, BoundedChan, CHXHtml, CSPM-CoreLanguage, CTRex, Cardinality, ChannelT, Chart, Chart-cairo, Chart-diagrams, Chart-gtk, Chart-gtk3, Chart-tests, ChasingBottoms, CheatSheet, CirruParser, Clipboard, Codec-Compression-LZF, Color, ConfigFile, ConsStream, Control-Engine, DAV, DBFunctor, DCFL, DPutils, Data-Angle, Data-Hash-Consistent, DataVersion, DebugTraceHelpers, Decimal, DescriptiveKeys, Diff, Digit, DigitGroup, DistanceTransform, DistanceUnits, Docs, EEConfig, ENIG, Earley, Ebnf2ps, EdisonAPI, EdisonCore, Enum, EuroIT, FAI, FailT, FenwickTree, FindBin, FixedPoint-simple, FloatingHex, Focus, Folly, FontyFruity, ForestStructures, FpMLv53, FractalArt, Frames, FunGEn, GA, GHood, GLFW-b, GLM, GLURaw, GLUT, GLUtil, GOST34112012-Hash, GaussQuadIntegration, GenericPretty, Geodetic, GeomPredicates, GiveYouAHead, Glob, GlomeVec, GoogleChart, GoogleSuggest, GraphSCC, HAppSHelpers, HCL, HCodecs, HDBC, HDBC-odbc, HDBC-postgresql, HDBC-session, HDBC-sqlite3, HGL, HListPP, HMap, HMock, HNumeric, HPDF, HSH, HSlippyMap, HSmarty, HStringTemplate, HSvm, HTF, HTTP, HTTP-Simple, HUnit, HUnit-approx, HaTeX, HaXml, HandsomeSoup, HasBigDecimal, HasChor, HaskellNet, HaskellNet-SSL, Hastodon, Hclip, Histogram, HoleyMonoid, Homology, HostAndPort, HsASA, HsHTSLib, HsOpenSSL, HsOpenSSL-x509-system, HsSyck, HsYAML, HsYAML-aeson, HyloDP, IOSpec, IPv6Addr, IfElse, Imlib, IndentParser, IntGraph, InternedData, Interpolation, Interpolation-maxs, IntervalMap, IrrHaskell, JSONParser, JuicyCairo, JuicyPixels, JuicyPixels-extra, JuicyPixels-repa, JuicyPixels-scale-dct, JuicyPixels-stbir, KMP, KdTree, Kleislify, LDAP, LPFP-core, LParse, LTree, LambdaCalculator, LambdaDB, Lazy-Pbkdf2, LetsBeRational, LinguisticsTypes, List, ListLike, ListTree, ListWriter, ListZipper, MemoTrie, MicroCabal, MicroHs, MissingH, MissingK, MissingM, Modulo, MonadPrompt, MonadRandom, Monadoro, MorseCode, MultipletCombiner, MusicBrainz, MusicBrainz-libdiscid, NameGenerator, NestedSampling, NineP, NoHoed, Noise, NumInstances, NumLazyByteString, Numbers, ObjectName, OneTuple, Only, OpenAL, OpenGL, OpenGLRaw, OptDir, OrderedBits, Ordinals, PDBtools, PSQueue, ParsecTools, ParserFunction, PartialTypeSignatures, PastePipe, Peano, PenroseKiteDart, PlayHangmanGame, Plural, PropLogic, ProxN, Pup-Events-Client, Pup-Events-PQueue, PyF, QuasiText, QuickCheck, QuickCheck-GenT, QuickCheck-safe, RANSAC, RBTree, RFC1751, RSA, RSolve, Random123, Ranged-sets, Rasterific, Rattus, ReadArgs, RefSerialize, RoyalMonad, SDL, SDL-gfx, SDL-image, SDL-ttf, SHA, SHA2, SQLDeps, STM32F103xx-SVD, STMonadTrans, SVGFonts, SVGPath, SWMMoutGetMB, Safe, SafeSemaphore, SciBaseTypes, ShellCheck, ShowF, Shrub, Shu-thing, SimpleAES, SimpleEA, SimpleTableGenerator, Sit, SizeCompare, Spock-api, SpreadsheetML, Stack, StateVar, StateVar-transformer, StatisticalMethods, Stream, StringUtils, SvgIcons, TCache, TTTAS, TableAlgebra, Tensor, TernaryTrees, ThreadObjects, Tic-Tac-Toe, TraceUtils, Transhare, TreeT, Twofish, TypeNat, TypingTester, UISF, Unique, Unixutils, Useful, UtilityTM, Vec, Vec-Transform, VecN, ViennaRNA-bindings, ViennaRNAParser, Vulkan, WAVE, WidgetRattus, X11, X11-xft, X11-xshape, XAttr, XMLParser, Xauth, Yampa, Yampa-core, Yocto, ZipperAG, Zora, abc-puzzle, abstract-deque, abstract-deque-tests, abstract-par, acc, acid-state, acl2, acme-box, acme-cadre, acme-circular-containers, acme-cofunctor, acme-colosson, acme-cuteboy, acme-cutegirl, acme-default, acme-functors, acme-grawlix, acme-iot, acme-lolcat, acme-lookofdisapproval, acme-microwave, acme-missiles, acme-not-a-joke, acme-omitted, acme-one, acme-pointful-numbers, acme-realworld, acme-smuggler, acme-timemachine, acme-year, action-permutations, active, ad, ad-delcont, adaptive-cubature, adblock2privoxy, addLicenseInfo, adhoc-fixtures, adjunctions, adler32, advent-of-code-api, advent-of-code-ocr, aern2-fun, aern2-mfun, aern2-mp, aern2-real, aeson, aeson-attoparsec, aeson-better-errors, aeson-casing, aeson-coerce, aeson-combinators, aeson-diff, aeson-extra, aeson-generic-compat, aeson-helper, aeson-iproute, aeson-match-qq, aeson-optics, aeson-picker, aeson-pretty, aeson-qq, aeson-quick, aeson-result, aeson-schemas, aeson-serialize, aeson-tiled, aeson-typescript, aeson-unqualified-ast, aeson-value-parser, aeson-via, aeson-warning-parser, aeson-yak, aeson-yaml, affinely-extended, agda2lagda, agreeing, agum, air, air-spec, aivika, aivika-branches, aivika-experiment, aivika-experiment-cairo, aivika-experiment-chart, aivika-experiment-diagrams, aivika-lattice, aivika-realtime, aivika-transformers, alarmclock, alea, alex, alex-meta, alex-tools, algebra, algebraic-graphs, align, align-audio, aligned-foreignptr, alignment, alist, allocated-processor, almost-fix, alternative-vector, alternators, altsvc, always, amazonka, amazonka-accessanalyzer, amazonka-account, amazonka-alexa-business, amazonka-amp, amazonka-amplify, amazonka-amplifybackend, amazonka-amplifyuibuilder, amazonka-apigateway, amazonka-apigatewaymanagementapi, amazonka-apigatewayv2, amazonka-appconfig, amazonka-appconfigdata, amazonka-appflow, amazonka-appintegrations, amazonka-application-autoscaling, amazonka-application-insights, amazonka-applicationcostprofiler, amazonka-appmesh, amazonka-apprunner, amazonka-appstream, amazonka-appsync, amazonka-arc-zonal-shift, amazonka-athena, amazonka-auditmanager, amazonka-autoscaling, amazonka-autoscaling-plans, amazonka-backup, amazonka-backup-gateway, amazonka-backupstorage, amazonka-batch, amazonka-billingconductor, amazonka-braket, amazonka-budgets, amazonka-certificatemanager, amazonka-certificatemanager-pca, amazonka-chime, amazonka-chime-sdk-identity, amazonka-chime-sdk-media-pipelines, amazonka-chime-sdk-meetings, amazonka-chime-sdk-messaging, amazonka-chime-sdk-voice, amazonka-cloud9, amazonka-cloudcontrol, amazonka-clouddirectory, amazonka-cloudformation, amazonka-cloudfront, amazonka-cloudhsm, amazonka-cloudhsmv2, amazonka-cloudsearch, amazonka-cloudsearch-domains, amazonka-cloudtrail, amazonka-cloudwatch, amazonka-cloudwatch-events, amazonka-cloudwatch-logs, amazonka-codeartifact, amazonka-codebuild, amazonka-codecommit, amazonka-codedeploy, amazonka-codeguru-reviewer, amazonka-codeguruprofiler, amazonka-codepipeline, amazonka-codestar, amazonka-codestar-connections, amazonka-codestar-notifications, amazonka-cognito-identity, amazonka-cognito-idp, amazonka-cognito-sync, amazonka-comprehend, amazonka-comprehendmedical, amazonka-compute-optimizer, amazonka-config, amazonka-connect, amazonka-connect-contact-lens, amazonka-connectcampaigns, amazonka-connectcases, amazonka-connectparticipant, amazonka-controltower, amazonka-core, amazonka-cost-explorer, amazonka-cur, amazonka-customer-profiles, amazonka-databrew, amazonka-dataexchange, amazonka-datapipeline, amazonka-datasync, amazonka-detective, amazonka-devicefarm, amazonka-devops-guru, amazonka-directconnect, amazonka-discovery, amazonka-dlm, amazonka-dms, amazonka-docdb, amazonka-docdb-elastic, amazonka-drs, amazonka-ds, amazonka-dynamodb, amazonka-dynamodb-dax, amazonka-dynamodb-streams, amazonka-ebs, amazonka-ec2, amazonka-ec2-instance-connect, amazonka-ecr, amazonka-ecr-public, amazonka-ecs, amazonka-efs, amazonka-eks, amazonka-elastic-inference, amazonka-elasticache, amazonka-elasticbeanstalk, amazonka-elasticsearch, amazonka-elastictranscoder, amazonka-elb, amazonka-elbv2, amazonka-emr, amazonka-emr-containers, amazonka-emr-serverless, amazonka-evidently, amazonka-finspace, amazonka-finspace-data, amazonka-fis, amazonka-fms, amazonka-forecast, amazonka-forecastquery, amazonka-frauddetector, amazonka-fsx, amazonka-gamelift, amazonka-gamesparks, amazonka-glacier, amazonka-globalaccelerator, amazonka-glue, amazonka-grafana, amazonka-greengrass, amazonka-greengrassv2, amazonka-groundstation, amazonka-guardduty, amazonka-health, amazonka-healthlake, amazonka-honeycode, amazonka-iam, amazonka-identitystore, amazonka-imagebuilder, amazonka-importexport, amazonka-inspector, amazonka-inspector2, amazonka-iot, amazonka-iot-analytics, amazonka-iot-dataplane, amazonka-iot-jobs-dataplane, amazonka-iot-roborunner, amazonka-iot1click-devices, amazonka-iot1click-projects, amazonka-iotdeviceadvisor, amazonka-iotevents, amazonka-iotevents-data, amazonka-iotfleethub, amazonka-iotfleetwise, amazonka-iotsecuretunneling, amazonka-iotsitewise, amazonka-iotthingsgraph, amazonka-iottwinmaker, amazonka-iotwireless, amazonka-ivs, amazonka-ivschat, amazonka-kafka, amazonka-kafkaconnect, amazonka-kendra, amazonka-keyspaces, amazonka-kinesis, amazonka-kinesis-analytics, amazonka-kinesis-firehose, amazonka-kinesis-video, amazonka-kinesis-video-archived-media, amazonka-kinesis-video-media, amazonka-kinesis-video-signaling, amazonka-kinesis-video-webrtc-storage, amazonka-kinesisanalyticsv2, amazonka-kms, amazonka-lakeformation, amazonka-lambda, amazonka-lex-models, amazonka-lex-runtime, amazonka-lexv2-models, amazonka-license-manager, amazonka-license-manager-linux-subscriptions, amazonka-license-manager-user-subscriptions, amazonka-lightsail, amazonka-location, amazonka-lookoutequipment, amazonka-lookoutmetrics, amazonka-lookoutvision, amazonka-m2, amazonka-macie, amazonka-maciev2, amazonka-managedblockchain, amazonka-marketplace-analytics, amazonka-marketplace-catalog, amazonka-marketplace-entitlement, amazonka-marketplace-metering, amazonka-mechanicalturk, amazonka-mediaconnect, amazonka-mediaconvert, amazonka-medialive, amazonka-mediapackage, amazonka-mediapackage-vod, amazonka-mediastore, amazonka-mediastore-dataplane, amazonka-mediatailor, amazonka-memorydb, amazonka-mgn, amazonka-migration-hub-refactor-spaces, amazonka-migrationhub, amazonka-migrationhub-config, amazonka-migrationhuborchestrator, amazonka-migrationhubstrategy, amazonka-ml, amazonka-mobile, amazonka-mq, amazonka-mtl, amazonka-mwaa, amazonka-neptune, amazonka-network-firewall, amazonka-networkmanager, amazonka-nimble, amazonka-oam, amazonka-omics, amazonka-opensearch, amazonka-opensearchserverless, amazonka-opsworks, amazonka-opsworks-cm, amazonka-organizations, amazonka-outposts, amazonka-panorama, amazonka-personalize, amazonka-personalize-events, amazonka-personalize-runtime, amazonka-pi, amazonka-pinpoint, amazonka-pinpoint-email, amazonka-pinpoint-sms-voice, amazonka-pinpoint-sms-voice-v2, amazonka-pipes, amazonka-polly, amazonka-pricing, amazonka-privatenetworks, amazonka-proton, amazonka-qldb, amazonka-qldb-session, amazonka-quicksight, amazonka-ram, amazonka-rbin, amazonka-rds, amazonka-rds-data, amazonka-redshift, amazonka-redshift-data, amazonka-redshift-serverless, amazonka-rekognition, amazonka-resiliencehub, amazonka-resource-explorer-v2, amazonka-resourcegroups, amazonka-resourcegroupstagging, amazonka-robomaker, amazonka-rolesanywhere, amazonka-route53, amazonka-route53-autonaming, amazonka-route53-domains, amazonka-route53-recovery-cluster, amazonka-route53-recovery-control-config, amazonka-route53-recovery-readiness, amazonka-route53resolver, amazonka-rum, amazonka-s3, amazonka-s3-encryption, amazonka-s3-streaming, amazonka-s3outposts, amazonka-sagemaker, amazonka-sagemaker-a2i-runtime, amazonka-sagemaker-edge, amazonka-sagemaker-featurestore-runtime, amazonka-sagemaker-geospatial, amazonka-sagemaker-metrics, amazonka-sagemaker-runtime, amazonka-savingsplans, amazonka-scheduler, amazonka-schemas, amazonka-sdb, amazonka-secretsmanager, amazonka-securityhub, amazonka-securitylake, amazonka-serverlessrepo, amazonka-service-quotas, amazonka-servicecatalog, amazonka-servicecatalog-appregistry, amazonka-ses, amazonka-sesv2, amazonka-shield, amazonka-signer, amazonka-simspaceweaver, amazonka-sms, amazonka-sms-voice, amazonka-snow-device-management, amazonka-snowball, amazonka-sns, amazonka-sqs, amazonka-ssm, amazonka-ssm-contacts, amazonka-ssm-incidents, amazonka-ssm-sap, amazonka-sso, amazonka-sso-admin, amazonka-sso-oidc, amazonka-stepfunctions, amazonka-storagegateway, amazonka-sts, amazonka-support, amazonka-support-app, amazonka-swf, amazonka-synthetics, amazonka-test, amazonka-textract, amazonka-timestream-query, amazonka-timestream-write, amazonka-transcribe, amazonka-transfer, amazonka-translate, amazonka-voice-id, amazonka-waf, amazonka-waf-regional, amazonka-wafv2, amazonka-wellarchitected, amazonka-wisdom, amazonka-workdocs, amazonka-worklink, amazonka-workmail, amazonka-workmailmessageflow, amazonka-workspaces, amazonka-workspaces-web, amazonka-xray, amqp, amqp-utils, amrun, anagrep, anitomata, ann, annihilator, annotated-exception, annotated-wl-pprint, ansi-escape-codes, ansi-terminal, ansi-terminal-game, ansi-terminal-types, ansi-wl-pprint, antiprimes, any-pat, aop-prelude, aos-signature, ap-normalize, ap-reflect, apecs, apecs-gloss, apecs-physics, apecs-physics-gloss, apecs-stm, api-field-json-th, api-opentheory-unicode, apioiaf-client, appar, appendful, appendmap, applicable, applicative-extras, applicative-numbers, apply-merge, apply-refact, apply-unordered-mono, apportionment, approximate, approximate-equality, ar-timestamp-wiper, arbor-datadog, arbtt, arcgrid, arcgrid-viewer, arch-web, archive-libarchive, archive-sig, arion-compose, arithmatic, arithmetic, arithmoi, arity-generic-liftA, array-builder, array-chunks, array-memoize, array-utils, arrow-extras, arrow-utils, arrows, arx, arxiv, asana, ascetic, ascii, ascii-art-to-unicode, ascii-case, ascii-caseless, ascii-char, ascii-group, ascii-holidays, ascii-numbers, ascii-predicates, ascii-progress, ascii-superset, ascii-th, asciichart, asn, asn1-encoding, asn1-parse, asn1-types, asn1dump, aspell-pipe, assert-failure, asset-bundle, assoc, ast-path, astar, astview-utils, async, async-ajax, async-extra, async-extras, async-io-either, async-pool, async-refresh, async-refresh-tokens, atl, atlas, atmos, atmos-dimensional, atom-basic, atom-conduit, atomic-counter, atomic-file-ops, atomic-modify-general, atomic-primops, atomic-write, atrans, atrophy, attoparsec, attoparsec-aeson, attoparsec-arff, attoparsec-base64, attoparsec-binary, attoparsec-conduit, attoparsec-data, attoparsec-expr, attoparsec-framer, attoparsec-ip, attoparsec-iso8601, attoparsec-parsec, attoparsec-path, attoparsec-run, attoparsec-time, attoparsec-uri, audacity, authenticate, authenticate-kerberos, authenticate-oauth, auto-lift-classes, auto-update, autodocodec, autodocodec-openapi3, autodocodec-schema, autodocodec-servant-multipart, autodocodec-swagger2, autodocodec-yaml, autoexporter, automitive-cse, automotive-cse, avahi, average, avif, aws, aws-arn, aws-lambda-haskell-runtime, aws-lambda-haskell-runtime-wai, aws-secrets, aws-sns-verify, aws-xray-client, aws-xray-client-persistent, aws-xray-client-wai, backprop, backtracking, bacteria, bank-holiday-germany, bank-holiday-usa, bank-holidays-england, barbies, barbies-layered, barbly, barlow-lens, base-compat, base-compat-batteries, base-noprelude, base-orphans, base-prelude, base-unicode-symbols, base16, base16-bytestring, base32, base32string, base58-bytestring, base58string, base64, base64-bytes, base64-bytestring, base64-bytestring-type, base64-string, base91, basement, basen-bytestring, basic-cpuid, basic-lens, basic-prelude, batch, batch-rename, battleship-combinatorics, bazel-runfiles, bbdb, bcp47, bcp47-orphans, bcrypt, beam-automigrate, beam-core, beam-migrate, beam-postgres, beam-sqlite, beeminder-api, belgian-structured-communication, bench, benchmark-function, benchpress, bencode, bencoding, benri-hspec, bento, between, bf-cata, bibtex, bifunctor-classes-compat, bifunctors, bighugethesaurus, bimap, bimap-server, bimaps, bin, binance-exports, binary-conduit, binary-enum, binary-generic, binary-generic-combinators, binary-ieee754, binary-instances, binary-io, binary-list, binary-literal-qq, binary-orphans, binary-parser, binary-search, binary-serialise-cbor, binary-shared, binary-state, binary-tagged, binary-varint, binarydefer, binaryen, binder, bindings, bindings-DSL]
    permissions:
      contents: read
      id-token: write
    steps:
      - uses: actions/checkout@v3
      - uses: DeterminateSystems/nix-installer-action@main
      - uses: DeterminateSystems/magic-nix-cache-action@main
      - run: nix-build nix/non-broken-haskell-packages.nix -A non-broken.${{ matrix.package }}
